<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OpenChat :: Main</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --bg:#0a0018; --scanline: rgba(255,255,255,0.03); }
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(50% 50% at 20% 20%, rgba(176,92,255,0.12), transparent 60%),
        radial-gradient(40% 40% at 80% 80%, rgba(0,229,229,0.08), transparent 60%),
        var(--bg);
      color:#e8dfff;
      font-family: 'Share Tech Mono', ui-monospace, SFMono-Regular, Menlo, monospace;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .scanlines:before{ content:""; position:fixed; inset:0; pointer-events:none; background-image:linear-gradient(var(--scanline) 1px, transparent 1px); background-size:100% 3px; mix-blend-mode:overlay; opacity:.6 }
    .appear span{opacity:0;display:inline-block;transform:translateY(6px)}
    @keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
    .card{ background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.16) }
    .card:hover{ border-color: rgba(255,255,255,0.28) }
    .pill{ background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.14) }
    .sidebar{ background: rgba(255,255,255,0.04); border-right: 1px solid rgba(255,255,255,0.12) }
    .search{ background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.18) }
    .search:focus{ border-color:#8b5cf6; box-shadow:0 0 0 3px rgba(139,92,246,.15) }
    .cutscene{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:50; background:
      radial-gradient(50% 50% at 20% 20%, rgba(176,92,255,0.12), transparent 60%),
      radial-gradient(40% 40% at 80% 80%, rgba(0,229,229,0.08), transparent 60%), var(--bg);
    }
    .cutscene.fade-out{ animation: fadeOut .6s ease forwards }
    @keyframes fadeOut{ to { opacity:0; visibility:hidden } }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // Character-by-character for all .appear nodes
      var animatedNodes = document.querySelectorAll('.appear');
      animatedNodes.forEach(function(node, groupIndex){
        var text = (node.textContent || '').trim();
        node.textContent = '';
        for (var i = 0; i < text.length; i++){
          var span = document.createElement('span');
          span.textContent = text[i];
          span.style.animation = 'fadeUp .45s forwards';
          span.style.animationDelay = (i * 45 + groupIndex * 180) + 'ms';
          node.appendChild(span);
        }
      });

      // Load data
      function renderRecent(list){
        var ul = document.getElementById('recentList');
        if(!ul) return;
        ul.innerHTML = '';
        list.forEach(function(item){
          var li = document.createElement('li');
          li.className = 'flex items-center gap-3 p-2 rounded-md hover:bg-white/5 cursor-pointer';
          li.innerHTML = '<div class="h-8 w-8 rounded-full bg-white/20"></div>'+
                         '<div><div class="text-sm">'+ item.name +'</div>'+
                         '<div class="text-[10px] opacity-70">last: '+ item.last +'</div></div>';
          if (item.id) {
            li.addEventListener('click', function(){ window.location.href = '/chat/' + item.id; });
          }
          ul.appendChild(li);
        });
      }

      function tagPill(label){ return '<span class="pill px-2 py-1 rounded text-[10px]">'+ label +'</span>'; }

      function renderBots(bots){
        var row = document.getElementById('botsRow');
        if(!row) return;
        row.innerHTML = '';
        bots.forEach(function(bot){
          var card = document.createElement('div');
          card.className = 'card rounded-lg p-4 cursor-pointer hover:bg-white/5';
          var tags = (bot.tags || []).map(tagPill).join('');
          card.innerHTML =
            '<div class="flex items-center gap-3 mb-3">'+
              '<div class="h-10 w-10 rounded-full bg-white/25"></div>'+
              '<div>'+ 
                '<div class="text-base">'+ bot.name +'</div>'+
                '<div class="text-[10px] opacity-70">#'+ (bot.tags ? bot.tags.slice(0,2).join(' #') : '') +'</div>'+
              '</div>'+ 
            '</div>'+ 
            '<div class="flex flex-wrap gap-2">'+ tags +'</div>';
          if (bot.id) {
            card.addEventListener('click', function(){ window.location.href = '/chat/' + bot.id; });
          }
          row.appendChild(card);
        });
      }

      Promise.all([
        fetch('/api/recent').then(function(r){ return r.json(); }).catch(function(){ return []; }),
        fetch('/api/bots').then(function(r){ return r.json(); }).catch(function(){ return []; })
      ]).then(function(results){
        renderRecent(results[0] || []);
        renderBots(results[1] || []);
      });

      // Short cutscene then reveal content
      var overlay = document.getElementById('cutscene');
      setTimeout(function(){ overlay.classList.add('fade-out'); }, 1400);
      setTimeout(function(){ overlay.style.display = 'none'; }, 2100);
    });
  </script>
</head>
<body class="scanlines">
  <!-- Cutscene overlay -->
  <div id="cutscene" class="cutscene">
    <div>
      <h1 class="appear text-center text-4xl tracking-[0.35em]">OPENCHAT</h1>
    </div>
  </div>

  <!-- Main layout -->
  <div class="min-h-screen flex">
    <!-- Left: recent chats -->
    <aside class="sidebar w-64 hidden md:flex flex-col">
      <div class="p-4">
        <div class="text-xs tracking-widest mb-3 opacity-80">RECENT</div>
        <ul id="recentList" class="space-y-2"></ul>
      </div>
      <div class="mt-auto p-4 border-t border-white/10">
        <button type="button" onclick="window.location.href='/profile'" class="w-full flex items-center gap-3 p-2 rounded-md hover:bg-white/5">
          <div class="h-8 w-8 rounded-full bg-white/25"></div>
          <div>
            <div class="text-sm">@username</div>
            <div class="text-[10px] opacity-70">Profile</div>
          </div>
        </button>
      </div>
    </aside>

    <!-- Center content -->
    <main class="flex-1 px-4 md:px-8 py-6">
      <!-- Search higher than scrolling bar -->
      <div class="max-w-3xl mx-auto mb-6">
        <div class="text-center mb-2">
          <h1 class="appear text-3xl tracking-widest">OPENCHAT</h1>
        </div>
        <div class="relative">
          <input type="text" placeholder="Search bots..." class="search w-full rounded-md px-4 py-3 pr-10" />
          <span class="absolute right-3 top-1/2 -translate-y-1/2 opacity-70">âŒ•</span>
        </div>
      </div>

      <!-- Scrolling bar of bots (center) -->
      <section class="max-w-5xl mx-auto">
        <div class="text-xs tracking-widest mb-3 opacity-80 text-center">FEATURED BOTS</div>
        <div class="overflow-y-auto pr-1 max-h-[60vh]">
          <div id="botsRow" class="flex flex-col gap-4 px-1"></div>
        </div>
      </section>
    </main>
  </div>
</body>
</html>


